<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Livro</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <h1>üìö Editar Livro</h1>

    <form action="/livros/editar" method="POST">
        <input type="hidden" name="id_livro" value="<%= livro.id_livro || livro.id %>">

        <label>T√≠tulo do Livro</label>
        <input type="text" name="titulo" value="<%= livro.titulo %>" required>

        <label>Autor</label>
        <input id="autorLivroEdit" type="text" name="autor" value="<%= livro.autor %>" required>
        <span id="warningAutorLivroEdit" class="warning" role="alert">O nome do autor n√£o pode conter n√∫meros.</span>

        <label>Ano de Publica√ß√£o</label>
        <input id="anoLivroEdit" type="text" name="ano_publicacao" value="<%= livro.ano_publicacao || livro.ano %>" required>
        <span id="warningAnoLivroEdit" class="warning" role="alert">O ano de publica√ß√£o deve ser num√©rico.</span>

        <label>Categoria</label>
        <input type="text" name="categoria" value="<%= livro.categoria %>">

        <button type="submit">Salvar Altera√ß√µes</button>
    </form>

    <a href="/livros">Cancelar</a>
    <script>
        (function(){
            const autor = document.getElementById('autorLivroEdit');
            const ano = document.getElementById('anoLivroEdit');
            const warnAutor = document.getElementById('warningAutorLivroEdit');
            const warnAno = document.getElementById('warningAnoLivroEdit');
            const form = document.querySelector('form[action="/livros/editar"]');

            function validarAutor() {
                const hasDigit = /\d/.test(autor.value);
                warnAutor.classList.toggle('show', hasDigit);
                return !hasDigit;
            }

            function validarAno() {
                const hasNonDigit = /\D/.test(ano.value);
                const isOk = ano.value.trim() === '' ? true : !hasNonDigit;
                warnAno.classList.toggle('show', !isOk);
                return isOk;
            }

            autor.addEventListener('input', validarAutor);
            ano.addEventListener('input', validarAno);

            form.addEventListener('submit', function(e){
                const okAutor = validarAutor();
                const okAno = validarAno();
                if (!okAutor || !okAno) {
                    e.preventDefault();
                    (okAutor ? ano : autor).focus();
                }
            });
        })();
    </script>
</body>
</html>